<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="menu.js"></script>
    <title>Bienvenido $user</title>
    <link rel="stylesheet" href="css/estilos.css">



</head>
<body>

    <div class="padre">
        <div class="borroso"></div>

        <div class="header">
               <h2 class="saludo">Bienvenido,</h2><h2 class="saludo" id="usuario">$user</h2>

               <button class="logout">Cerrar Sesion</button>
        </div>
        <div class="cuerpo">

             <h2 class="encabezado">Listado de Transacciones</h2>

             <table class="table">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Descripción</th>
            <th>Monto</th>
            <th>Tipo</th>
            <th>Cuenta</th>
            <th>Cuenta contrapartida</th>
          </tr>
        </thead>
        <tbody>
            
        <?php

        require_once 'conexion.php';

        // Recorrer resultados
        while ($row = sqlsrv_fetch_array($stmt, SQLSRV_FETCH_ASSOC)) {
            // Protección básica contra XSS
            $id = htmlspecialchars($row['id_transaccion']);
            // Fecha: convertir a formato legible si viene como objeto DateTime
            $fecha = $row['fecha'];
            if ($fecha instanceof DateTime) {
                $fecha = $fecha->format('Y-m-d');
            } else {
                $fecha = htmlspecialchars($fecha);
            }
            $descripcion = htmlspecialchars($row['descripcion']);
            // Formatear monto con 2 decimales
            $monto = number_format((float)$row['monto'], 2, '.', ',');
            $tipo = htmlspecialchars($row['tipo']);
            $cuenta = htmlspecialchars($row['cuenta']);
            $cuenta_contra = htmlspecialchars($row['cuenta_contra']);

            echo "<tr>
                    <td>{$id}</td>
                    <td>{$fecha}</td>
                    <td>{$descripcion}</td>
                    <td class='text-end'>{$monto}</td>
                    <td>{$tipo}</td>
                    <td>{$cuenta}</td>
                    <td>{$cuenta_contra}</td>
                  </tr>";
        }
        // Liberar recursos
        sqlsrv_free_stmt($stmt);
        sqlsrv_close($conn);
        ?>
        </tbody>
      </table>



        </div>

    </div>

</body>
</html>